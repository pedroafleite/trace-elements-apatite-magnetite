---
title: "Apatite trace elements"
author: "Pedro Leite"
date: "12-10-2020"
output: html_notebook
---

## R markdown

Or create a `github_document` instead, like the one that you are reading.

```{r message=FALSE, warning=FALSE}
library(cowplot)
library(compositions)
library(ggplot2)
library(grid)
library(gtable)
library(ggbiplot)
library(gridExtra)

```

## GitHub Documents

This is an R Markdown format used for publishing markdown documents to GitHub. When you click the **Knit** button all R code chunks are run and a markdown file (.md) suitable for publishing to GitHub is generated.

```{r}
geochem_ap <- read.csv2('C:/Users/Pedro/Documents/Rconsole/Apatite_git/geochem_ap.csv', 
                        header = TRUE, 
                        stringsAsFactors=TRUE, 
                        na = "NA",
                        dec = ".",
                        sep=";")
str(geochem_ap)
geochem_ap
```


## Multielemental boxplots

These diagrams are incredibly useful when analysing multiple elements from multiple sources as we did, and may be useful for other kinds of geochemical analysis.

However, before exhibiting those, we need to correct some of the boxplots in which a few outliers inhibit us from seeing the right scales of elemental concentrations in them. Otherwise, we would not visualise the proportions between each boxplot, and would not be able to evaluate them.

In our case, the elements would be Mg, Sr, Ba, Pb, Ti, V and As. They were selected by trial-and-error, once the multielemental boxplots were made and the incongruencies were visually detected.

```{r}
theme_set(theme_classic())
```


The code for deleting the outliers from the elemental features follows:

```{r}
#Removing outliers from Mg concentrations
outliersMg <- boxplot(geochem_ap$Mg_ppm, ylab="Mg (ppm)")$out
print("Mg outliers:")
print(outliersMg)
outap_Mg <- geochem_ap[-which(geochem_ap$Mg_ppm %in% outliersMg),]
qplot(Zone, Mg_ppm, data=outap_Mg, geom="boxplot", colour=Deposit)

#Removing outliers from Sr concentrations
outliersSr <- boxplot(geochem_ap$Sr_ppm, ylab="Sr (ppm)")$out
print("Sr outliers:")
print(outliersSr)
outap_Sr <- geochem_ap[-which(geochem_ap$Sr_ppm %in% outliersSr),]
qplot(Zone, Sr_ppm, data=outap_Sr, geom="boxplot", colour=Deposit)

#Removing outliers from Ba concentrations
outliersBa <- boxplot(geochem_ap$Ba_ppm, ylab="Ba (ppm)")$out
print("Ba outliers:")
print(outliersBa)
outap_Ba <- geochem_ap[-which(geochem_ap$Ba_ppm %in% outliersBa),]
qplot(Zone, Ba_ppm, data=outap_Ba, geom="boxplot", colour=Deposit)

#Removing outliers from Pb concentrations
outliersPb <- boxplot(geochem_ap$Pb_ppm, ylab="Pb (ppm)")$out
print("Pb outliers:")
print(outliersPb)
outap_Pb <- geochem_ap[-which(geochem_ap$Pb_ppm %in% outliersPb),]
qplot(Zone, Pb_ppm, data=outap_Pb, geom="boxplot", colour=Deposit)

#Removing outliers from Ti concentrations
outliersTi <- boxplot(geochem_ap$Ti_ppm, ylab="Ti (ppm)")$out
print("Ti outliers:")
print(outliersTi)
outap_Ti <- geochem_ap[-which(geochem_ap$Ti_ppm %in% outliersTi),]
qplot(Zone, Ti_ppm, data=outap_Ti, geom="boxplot", colour=Deposit)

#Removing outliers from V concentrations
outliersV <- boxplot(geochem_ap$V_ppm, ylab="V (ppm)")$out
print("V outliers:")
print(outliersV)
outap_V <- geochem_ap[-which(geochem_ap$V_ppm %in% outliersV),]
qplot(Zone, V_ppm, data=outap_V, geom="boxplot", colour=Deposit)

#Removing outliers from As concentrations
outliersAs <- boxplot(geochem_ap$As_ppm, ylab="As (ppm)")$out
print("As outliers:")
print(outliersAs)
outap_As <- geochem_ap[-which(geochem_ap$As_ppm %in% outliersAs),]
qplot(Zone, As_ppm, data=outap_As, geom="boxplot", colour=Deposit)
qplot(Zone, V_ppm, data=outap_V, geom="boxplot", colour=Deposit)
```

Besides that, we would prefer to agglutinate Light Rare Earth Elements (LREE) into a singular feature, since they display similar patterns and might exhibit a better response if they are summed up together.

```{r}
SumLREE <- (geochem_ap[,"La_ppm"]+geochem_ap[,"Ce_ppm"]+geochem_ap[,"Pr_ppm"]+
              geochem_ap[,"Nd_ppm"]+geochem_ap[,"Sm_ppm"])
SumHREE <- (geochem_ap[,"Gd_ppm"]+geochem_ap[,"Tb_ppm"]+geochem_ap[,"Dy_ppm"]+
              geochem_ap[,"Ho_ppm"]+geochem_ap[,"Er_ppm"]+geochem_ap[,"Tm_ppm"]+
              geochem_ap[,"Yb_ppm"]+geochem_ap[,"Lu_ppm"])
LaSm <- ((geochem_ap[,"La_ppm"]/0.237)/(geochem_ap[,"Sm_ppm"]/0.148))
eueu <- ((geochem_ap[,"Eu_ppm"]/0.0563)*
           (((geochem_ap[,"Sm_ppm"]/0.148)*(geochem_ap[,"Gd_ppm"]/0.199)))^-0.5)
cece <- ((geochem_ap[,"Ce_ppm"]/0.613)*
           (((geochem_ap[,"La_ppm"]/0.237)*(geochem_ap[,"Pr_ppm"]/0.0928)))^-0.5)

geochem_ap$SumLREE=SumLREE
geochem_ap$SumHREE=SumHREE
geochem_ap$LaSm=LaSm
geochem_ap$eueu=eueu
geochem_ap$cece=cece
```


Once the corrections are made, we visualise the multielements boxplots via:

```{r}
qplot(Zone, Ca_pct, data=geochem_ap, geom="boxplot", colour=Class, ylab="Ca (wt. %)") 
qplot(Zone, P_pct, data=geochem_ap, geom="boxplot", colour=Class, ylab="P (wt. %)")  

qplot(Zone, Cl_pct, data=geochem_ap, geom="boxplot", colour=Class, ylab="Cl (wt. %)") 
qplot(Zone, F_pct, data=geochem_ap, geom="boxplot", colour=Class, ylab="F (wt. %)") 
p51 <- qplot(Zone, Na_pct, data=geochem_ap, geom="boxplot", colour=Class, ylab="Na (wt. %)") 

qplot(Zone, Si_pct, data=geochem_ap, geom="boxplot", colour=Class, ylab="Si (wt. %)") 
qplot(Zone, Mg_ppm, data=outap_Mg, geom="boxplot", colour=Class, ylab="Mg (ppm)") 

qplot(Zone, Mn_ppm, data=geochem_ap, geom="boxplot", colour=Class, ylab="Mn (ppm)") 

qplot(Zone, Sr_ppm, data=outap_Sr, geom="boxplot", colour=Class, ylab="Sr (ppm)") 

qplot(Zone, Ba_ppm, data=outap_Ba, geom="boxplot", colour=Class, ylab="Ba (ppm)") 

qplot(Zone, Pb_ppm, data=outap_Pb, geom="boxplot", colour=Class, ylab="Pb (ppm)") 

qplot(Zone, Ba_ppm, data=outap_Ba, geom="boxplot", colour=Class, ylab="Ba (ppm)")

qplot(Zone, Ti_ppm, data=outap_Ti, geom="boxplot", colour=Class, ylab="Ti (ppm)") 

qplot(Zone, Fe_pct, data=geochem_ap, geom="boxplot", colour=Class, ylab="Fe (wt. %)") 
qplot(Zone, SumLREE, data=geochem_ap, geom="boxplot", colour=Class, ylab="LREE (ppm)") 

qplot(Zone, SumHREE, data=geochem_ap, geom="boxplot", colour=Class, ylab="HREE (ppm)") 

qplot(Zone, Eu_ppm, data=geochem_ap, geom="boxplot", colour=Class, ylab="Eu (ppm)") 

qplot(Zone, Y_ppm, data=geochem_ap, geom="boxplot", colour=Class, ylab="Y (ppm)") 

qplot(Zone, V_ppm, data=outap_V, geom="boxplot", colour=Class, ylab="V (ppm)") 

qplot(Zone, As_ppm, data=outap_As, geom="boxplot", colour=Class, ylab="As (ppm)") 

qplot(Zone, Th232_ppm, data=geochem_ap, geom="boxplot", colour=Class, ylab="Th (ppm)") 

qplot(Zone, U238_ppm.1, data=geochem_ap, geom="boxplot", colour=Class, ylab="U (ppm)") 

qplot(Zone, Ge_ppm, data=geochem_ap, geom="boxplot", colour=Class, ylab="Ge (ppm)") 
```

